import {
  init_es_number_is_integer
} from "./chunk-MRJA3RZL.js";
import {
  init_web_url,
  init_web_url_search_params
} from "./chunk-PECE4WKN.js";
import {
  init_esm as init_esm4,
  isJSON,
  parse,
  stringify
} from "./chunk-SNOMC6VJ.js";
import {
  init_es_string_search
} from "./chunk-RAZJXK6A.js";
import {
  init_es_number_constructor
} from "./chunk-JFKL56PB.js";
import {
  require_lib
} from "./chunk-3JG7PP5Q.js";
import {
  esm_exports,
  init_esm as init_esm3
} from "./chunk-FRD2Y65G.js";
import {
  init_es_object_values
} from "./chunk-AKWMTN3F.js";
import {
  init_es_array_from,
  init_es_array_includes,
  init_es_array_map,
  init_es_function_name,
  init_es_object_assign,
  init_es_object_entries,
  init_es_string_includes,
  init_es_symbol,
  init_es_symbol_description,
  init_es_symbol_iterator
} from "./chunk-OPAZLAKG.js";
import {
  init_es_promise
} from "./chunk-ZFQV7LAJ.js";
import {
  esm_default,
  init_esm as init_esm2
} from "./chunk-4ZGR7LKU.js";
import {
  init_es_array_filter
} from "./chunk-VYLTT7BA.js";
import {
  init_es_array_slice,
  init_web_dom_collections_for_each
} from "./chunk-BNKHNS7O.js";
import {
  init_es_array_concat,
  init_esm,
  init_web_dom_collections_iterator,
  logger,
  pretty,
  require_create_property,
  require_es_array_iterator,
  require_es_regexp_exec,
  require_es_string_iterator
} from "./chunk-WDY4P2NX.js";
import {
  require_es_object_to_string,
  require_export,
  require_iterate
} from "./chunk-IPK6NK5O.js";
import {
  require_window
} from "./chunk-XCM4TOIV.js";
import {
  __esm,
  __toESM,
  init_define_ngDevMode
} from "./chunk-XN7ES5DP.js";

// node_modules/core-js/modules/es.object.from-entries.js
var $, iterate, createProperty;
var init_es_object_from_entries = __esm({
  "node_modules/core-js/modules/es.object.from-entries.js"() {
    init_define_ngDevMode();
    $ = require_export();
    iterate = require_iterate();
    createProperty = require_create_property();
    $({
      target: "Object",
      stat: true
    }, {
      fromEntries: function fromEntries(iterable) {
        var obj = {};
        iterate(iterable, function(k, v) {
          createProperty(obj, k, v);
        }, {
          AS_ENTRIES: true
        });
        return obj;
      }
    });
  }
});

// node_modules/@storybook/channel-postmessage/dist/esm/index.js
function _toArray(arr) {
  return _arrayWithHoles(arr) || _iterableToArray(arr) || _unsupportedIterableToArray(arr) || _nonIterableRest();
}
function _toConsumableArray(arr) {
  return _arrayWithoutHoles(arr) || _iterableToArray(arr) || _unsupportedIterableToArray(arr) || _nonIterableSpread();
}
function _nonIterableSpread() {
  throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.");
}
function _iterableToArray(iter) {
  if (typeof Symbol !== "undefined" && iter[Symbol.iterator] != null || iter["@@iterator"] != null)
    return Array.from(iter);
}
function _arrayWithoutHoles(arr) {
  if (Array.isArray(arr))
    return _arrayLikeToArray(arr);
}
function _slicedToArray(arr, i) {
  return _arrayWithHoles(arr) || _iterableToArrayLimit(arr, i) || _unsupportedIterableToArray(arr, i) || _nonIterableRest();
}
function _nonIterableRest() {
  throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.");
}
function _unsupportedIterableToArray(o, minLen) {
  if (!o)
    return;
  if (typeof o === "string")
    return _arrayLikeToArray(o, minLen);
  var n = Object.prototype.toString.call(o).slice(8, -1);
  if (n === "Object" && o.constructor)
    n = o.constructor.name;
  if (n === "Map" || n === "Set")
    return Array.from(o);
  if (n === "Arguments" || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))
    return _arrayLikeToArray(o, minLen);
}
function _arrayLikeToArray(arr, len) {
  if (len == null || len > arr.length)
    len = arr.length;
  for (var i = 0, arr2 = new Array(len); i < len; i++) {
    arr2[i] = arr[i];
  }
  return arr2;
}
function _iterableToArrayLimit(arr, i) {
  var _i = arr == null ? null : typeof Symbol !== "undefined" && arr[Symbol.iterator] || arr["@@iterator"];
  if (_i == null)
    return;
  var _arr = [];
  var _n = true;
  var _d = false;
  var _s, _e;
  try {
    for (_i = _i.call(arr); !(_n = (_s = _i.next()).done); _n = true) {
      _arr.push(_s.value);
      if (i && _arr.length === i)
        break;
    }
  } catch (err) {
    _d = true;
    _e = err;
  } finally {
    try {
      if (!_n && _i["return"] != null)
        _i["return"]();
    } finally {
      if (_d)
        throw _e;
    }
  }
  return _arr;
}
function _arrayWithHoles(arr) {
  if (Array.isArray(arr))
    return arr;
}
function _classCallCheck(instance, Constructor) {
  if (!(instance instanceof Constructor)) {
    throw new TypeError("Cannot call a class as a function");
  }
}
function _defineProperties(target, props) {
  for (var i = 0; i < props.length; i++) {
    var descriptor = props[i];
    descriptor.enumerable = descriptor.enumerable || false;
    descriptor.configurable = true;
    if ("value" in descriptor)
      descriptor.writable = true;
    Object.defineProperty(target, descriptor.key, descriptor);
  }
}
function _createClass(Constructor, protoProps, staticProps) {
  if (protoProps)
    _defineProperties(Constructor.prototype, protoProps);
  if (staticProps)
    _defineProperties(Constructor, staticProps);
  Object.defineProperty(Constructor, "prototype", {
    writable: false
  });
  return Constructor;
}
function createChannel(_ref5) {
  var page = _ref5.page;
  var transport = new PostmsgTransport({
    page
  });
  return new esm_default({
    transport
  });
}
var import_es_array_iterator, import_es_object_to_string, import_es_regexp_exec, import_es_string_iterator, import_global, import_qs, globalWindow, document, location, KEY, defaultEventOptions, PostmsgTransport, getEventSourceUrl;
var init_esm5 = __esm({
  "node_modules/@storybook/channel-postmessage/dist/esm/index.js"() {
    init_define_ngDevMode();
    import_es_array_iterator = __toESM(require_es_array_iterator());
    init_es_object_from_entries();
    init_es_array_filter();
    import_es_object_to_string = __toESM(require_es_object_to_string());
    init_es_object_entries();
    init_es_object_assign();
    init_es_number_is_integer();
    init_es_number_constructor();
    import_es_regexp_exec = __toESM(require_es_regexp_exec());
    init_es_string_search();
    init_es_promise();
    init_web_dom_collections_for_each();
    init_es_array_map();
    init_es_array_includes();
    init_es_string_includes();
    init_es_object_values();
    init_es_array_concat();
    import_es_string_iterator = __toESM(require_es_string_iterator());
    init_web_dom_collections_iterator();
    init_web_url();
    init_web_url_search_params();
    init_es_array_slice();
    init_es_symbol();
    init_es_symbol_description();
    init_es_symbol_iterator();
    init_es_function_name();
    init_es_array_from();
    import_global = __toESM(require_window());
    init_esm3();
    init_esm2();
    init_esm();
    init_esm4();
    import_qs = __toESM(require_lib());
    globalWindow = import_global.default.window;
    document = import_global.default.document;
    location = import_global.default.location;
    KEY = "storybook-channel";
    defaultEventOptions = {
      allowFunction: true,
      maxDepth: 25
    };
    PostmsgTransport = function() {
      function PostmsgTransport2(config) {
        _classCallCheck(this, PostmsgTransport2);
        this.config = config;
        this.buffer = void 0;
        this.handler = void 0;
        this.connected = void 0;
        this.buffer = [];
        this.handler = null;
        globalWindow.addEventListener("message", this.handleEvent.bind(this), false);
        if (config.page !== "manager" && config.page !== "preview") {
          throw new Error('postmsg-channel: "config.page" cannot be "'.concat(config.page, '"'));
        }
      }
      _createClass(PostmsgTransport2, [{
        key: "setHandler",
        value: function setHandler(handler) {
          var _this = this;
          this.handler = function() {
            for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {
              args[_key] = arguments[_key];
            }
            handler.apply(_this, args);
            if (!_this.connected && _this.getLocalFrame().length) {
              _this.flush();
              _this.connected = true;
            }
          };
        }
      }, {
        key: "send",
        value: function send(event, options) {
          var _this2 = this;
          var _ref = options || {}, target = _ref.target, allowRegExp = _ref.allowRegExp, allowFunction = _ref.allowFunction, allowSymbol = _ref.allowSymbol, allowDate = _ref.allowDate, allowUndefined = _ref.allowUndefined, allowClass = _ref.allowClass, maxDepth = _ref.maxDepth, space = _ref.space, lazyEval = _ref.lazyEval;
          var eventOptions = Object.fromEntries(Object.entries({
            allowRegExp,
            allowFunction,
            allowSymbol,
            allowDate,
            allowUndefined,
            allowClass,
            maxDepth,
            space,
            lazyEval
          }).filter(function(_ref2) {
            var _ref3 = _slicedToArray(_ref2, 2), k = _ref3[0], v = _ref3[1];
            return typeof v !== "undefined";
          }));
          var stringifyOptions = Object.assign({}, defaultEventOptions, import_global.default.CHANNEL_OPTIONS || {}, eventOptions);
          if (options && Number.isInteger(options.depth)) {
            stringifyOptions.maxDepth = options.depth;
          }
          var frames = this.getFrames(target);
          var query = import_qs.default.parse(location.search, {
            ignoreQueryPrefix: true
          });
          var data = stringify({
            key: KEY,
            event,
            refId: query.refId
          }, stringifyOptions);
          if (!frames.length) {
            return new Promise(function(resolve, reject) {
              _this2.buffer.push({
                event,
                resolve,
                reject
              });
            });
          }
          if (this.buffer.length) {
            this.flush();
          }
          frames.forEach(function(f) {
            try {
              f.postMessage(data, "*");
            } catch (e) {
              console.error("sending over postmessage fail");
            }
          });
          return Promise.resolve(null);
        }
      }, {
        key: "flush",
        value: function flush() {
          var _this3 = this;
          var buffer = this.buffer;
          this.buffer = [];
          buffer.forEach(function(item) {
            _this3.send(item.event).then(item.resolve).catch(item.reject);
          });
        }
      }, {
        key: "getFrames",
        value: function getFrames(target) {
          if (this.config.page === "manager") {
            var nodes = _toConsumableArray(document.querySelectorAll("iframe[data-is-storybook][data-is-loaded]"));
            var list = nodes.filter(function(e) {
              try {
                return !!e.contentWindow && e.dataset.isStorybook !== void 0 && e.id === target;
              } catch (er) {
                return false;
              }
            }).map(function(e) {
              return e.contentWindow;
            });
            return list.length ? list : this.getCurrentFrames();
          }
          if (globalWindow && globalWindow.parent && globalWindow.parent !== globalWindow) {
            return [globalWindow.parent];
          }
          return [];
        }
      }, {
        key: "getCurrentFrames",
        value: function getCurrentFrames() {
          if (this.config.page === "manager") {
            var list = _toConsumableArray(document.querySelectorAll('[data-is-storybook="true"]'));
            return list.map(function(e) {
              return e.contentWindow;
            });
          }
          if (globalWindow && globalWindow.parent) {
            return [globalWindow.parent];
          }
          return [];
        }
      }, {
        key: "getLocalFrame",
        value: function getLocalFrame() {
          if (this.config.page === "manager") {
            var list = _toConsumableArray(document.querySelectorAll("#storybook-preview-iframe"));
            return list.map(function(e) {
              return e.contentWindow;
            });
          }
          if (globalWindow && globalWindow.parent) {
            return [globalWindow.parent];
          }
          return [];
        }
      }, {
        key: "handleEvent",
        value: function handleEvent(rawEvent) {
          try {
            var data = rawEvent.data;
            var _ref4 = typeof data === "string" && isJSON(data) ? parse(data, import_global.default.CHANNEL_OPTIONS || {}) : data, key = _ref4.key, event = _ref4.event, refId = _ref4.refId;
            if (key === KEY) {
              var pageString = this.config.page === "manager" ? '<span style="color: #37D5D3; background: black"> manager </span>' : '<span style="color: #1EA7FD; background: black"> preview </span>';
              var eventString = Object.values(esm_exports).includes(event.type) ? '<span style="color: #FF4785">'.concat(event.type, "</span>") : '<span style="color: #FFAE00">'.concat(event.type, "</span>");
              if (refId) {
                event.refId = refId;
              }
              event.source = this.config.page === "preview" ? rawEvent.origin : getEventSourceUrl(rawEvent);
              if (!event.source) {
                pretty.error("".concat(pageString, " received ").concat(eventString, " but was unable to determine the source of the event"));
                return;
              }
              var message = "".concat(pageString, " received ").concat(eventString, " (").concat(data.length, ")");
              pretty.debug.apply(pretty, [location.origin !== event.source ? message : "".concat(message, ' <span style="color: gray">(on ').concat(location.origin, " from ").concat(event.source, ")</span>")].concat(_toConsumableArray(event.args)));
              this.handler(event);
            }
          } catch (error) {
            logger.error(error);
          }
        }
      }]);
      return PostmsgTransport2;
    }();
    getEventSourceUrl = function getEventSourceUrl2(event) {
      var frames = _toConsumableArray(document.querySelectorAll("iframe[data-is-storybook]"));
      var _frames$filter = frames.filter(function(element) {
        try {
          return element.contentWindow === event.source;
        } catch (err) {
        }
        var src2 = element.getAttribute("src");
        var origin;
        try {
          var _URL = new URL(src2, document.location);
          origin = _URL.origin;
        } catch (err) {
          return false;
        }
        return origin === event.origin;
      }), _frames$filter2 = _toArray(_frames$filter), frame = _frames$filter2[0], remainder = _frames$filter2.slice(1);
      if (frame && remainder.length === 0) {
        var src = frame.getAttribute("src");
        var _URL2 = new URL(src, document.location), protocol = _URL2.protocol, host = _URL2.host, pathname = _URL2.pathname;
        return "".concat(protocol, "//").concat(host).concat(pathname);
      }
      if (remainder.length > 0) {
        logger.error("found multiple candidates for event source");
      }
      return null;
    };
  }
});

export {
  KEY,
  PostmsgTransport,
  createChannel,
  init_esm5 as init_esm
};
//# sourceMappingURL=chunk-MV7M3ECF.js.map
